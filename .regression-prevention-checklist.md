# Regression Prevention Checklist

## CRITICAL: Before Making ANY Changes

### Pre-Change Checklist
- [ ] Understand the current working state
- [ ] Identify ALL files that will be affected
- [ ] Check if changes affect authentication/routing/core flows
- [ ] Test current state before making changes

### Post-Change Checklist
- [ ] **Authentication Test**: App shows login screen when not authenticated
- [ ] **Login Test**: Can login with valid credentials (rm1/rm1Rm@123456)
- [ ] **Dashboard Test**: Dashboard loads after successful login
- [ ] **New Application Test**: Can navigate to "New Application" page
- [ ] **Service Health**: All services are running on correct ports
- [ ] **No Console Errors**: Browser console shows no critical errors

### Critical Paths That Must NEVER Break

1. **Authentication Flow**
   - Login screen shows when not authenticated
   - Login works with valid credentials
   - Dashboard shows after successful login
   - Logout clears session and redirects to login

2. **Routing**
   - `/` redirects to login if not authenticated
   - `/rm/*` routes require authentication
   - `/login` is always accessible

3. **Service Communication**
   - Gateway routes to correct services
   - Services run on expected ports
   - API calls include proper authentication headers

### Files That Are CRITICAL (Modify with Extreme Caution)

- `web/src/shared/lib/auth/auth-stability.ts` - Single source of truth for auth
- `web/src/shared/hooks/useAuth.ts` - Main auth hook
- `web/src/components/AuthGuard.tsx` - Route protection
- `web/src/ui/App.tsx` - Root routing
- `web/src/main.tsx` - App initialization
- `gateway/src/server.ts` - API routing
- `gateway/src/auth.ts` - Gateway auth middleware

### Testing Before Committing

Run these commands:
```bash
# 1. Verify services are running
./scripts/verify-service-ports.sh

# 2. Check gateway routes
./scripts/audit-gateway-routes.sh

# 3. Test login flow
./scripts/verify-login-flow.sh

# 4. Build frontend (check for TypeScript errors)
cd web && npm run build
```

### Emergency Rollback

If something breaks:
1. **STOP** making changes
2. Check git status: `git status`
3. Review recent changes: `git diff`
4. Revert if needed: `git checkout -- <file>`
5. Test immediately after revert

### Common Regression Causes

1. **Changing authentication logic without testing**
2. **Modifying routing without checking all routes**
3. **Changing service ports without updating gateway**
4. **Removing error handling "because it's not needed"**
5. **Making "small" changes without testing**

### Golden Rules

1. **Never bypass authentication checks** - even "temporarily"
2. **Always test login flow** after any auth-related change
3. **Verify services are running** before testing
4. **Check console errors** - they usually indicate the problem
5. **One change at a time** - easier to identify what broke

### When In Doubt

1. Read the code carefully
2. Understand WHY it's written that way
3. Test the current state first
4. Make minimal changes
5. Test immediately
6. If it breaks, revert and think again

